(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9967:function(e,s,r){Promise.resolve().then(r.bind(r,8975)),Promise.resolve().then(r.bind(r,386))},8975:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return _}});var i=r(7437),l=r(2265),t=r(6581),a=r(7520),n=r(2435),o=r(6716),d=r(290),c=r(2245),u=r(3008),h=r(9617),m=r(1138),x=r(8203),v=r(8122),p=r(5823),g=r(912);function j(e){var s,r;let{resource:t,show:a,onHide:d,onSave:c}=e,[u,h]=(0,l.useState)(!1),[m,x]=(0,l.useState)(t.title),[v,j]=(0,l.useState)(t.url),[f,y]=(0,l.useState)(t.type),[b,Z]=(0,l.useState)(t.previewImage||""),[N,w]=(0,l.useState)(()=>{try{return JSON.parse(t.description)}catch(e){return{title:t.title,description:t.description,credentials:{},courseContent:[]}}});(0,l.useEffect)(()=>{if(a){x(t.title),j(t.url),y(t.type),Z(t.previewImage||"");try{w(JSON.parse(t.description))}catch(e){w({title:t.title,description:t.description,credentials:{},courseContent:[]})}}},[a,t]);let C=async e=>{e.preventDefault(),h(!0);try{let e={...N,title:m,previewImage:b};if(!(await fetch("/api/resources/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:m,url:v,type:f,previewImage:b,description:JSON.stringify(e,null,2)})})).ok)throw Error("Failed to update resource");c(),d()}catch(e){console.error("Error updating resource:",e)}finally{h(!1)}};return(0,i.jsx)(n.Z,{show:a,onHide:d,size:"lg",children:(0,i.jsxs)(p.Z,{onSubmit:C,children:[(0,i.jsx)(n.Z.Header,{closeButton:!0,children:(0,i.jsx)(n.Z.Title,{children:"Edit Resource"})}),(0,i.jsxs)(n.Z.Body,{children:[(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{children:"Title"}),(0,i.jsx)(p.Z.Control,{type:"text",value:m,onChange:e=>x(e.target.value),required:!0})]}),(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{children:"URL"}),(0,i.jsx)(p.Z.Control,{type:"url",value:v,onChange:e=>j(e.target.value)})]}),(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{children:"Preview Image URL"}),(0,i.jsx)(p.Z.Control,{type:"url",value:b,onChange:e=>Z(e.target.value),placeholder:"Enter image URL or /assets/... path"}),b&&(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)("img",{src:b,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"200px"}})})]}),(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{children:"Type"}),(0,i.jsxs)(p.Z.Select,{value:f,onChange:e=>y(e.target.value),"aria-label":"Resource type",children:[(0,i.jsx)("option",{value:"LINK",children:"Link"}),(0,i.jsx)("option",{value:"VIDEO",children:"Video"}),(0,i.jsx)("option",{value:"DOCUMENT",children:"Document"}),(0,i.jsx)("option",{value:"IMAGE",children:"Image"})]})]}),(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{children:"Description"}),(0,i.jsx)(g.M,{apiKey:"k8fzh2z7v1akjnv2yo197wht8fe2gv9ml9qn0lgc8li8298r",value:N.description,onEditorChange:e=>{w(s=>({...s,description:e}))},init:{height:300,menubar:!1,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","code","help","wordcount"],toolbar:"undo redo | blocks | bold italic forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"}})]}),(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{children:"Credentials"}),(0,i.jsxs)("div",{className:"bg-light rounded p-3",children:[(0,i.jsxs)(p.Z.Group,{className:"mb-2",children:[(0,i.jsx)(p.Z.Label,{children:"Username"}),(0,i.jsx)(p.Z.Control,{type:"text",value:(null===(s=N.credentials)||void 0===s?void 0:s.username)||"",onChange:e=>w(s=>({...s,credentials:{...s.credentials,username:e.target.value}}))})]}),(0,i.jsxs)(p.Z.Group,{children:[(0,i.jsx)(p.Z.Label,{children:"Password"}),(0,i.jsx)(p.Z.Control,{type:"text",value:(null===(r=N.credentials)||void 0===r?void 0:r.password)||"",onChange:e=>w(s=>({...s,credentials:{...s.credentials,password:e.target.value}}))})]})]})]})]}),(0,i.jsxs)(n.Z.Footer,{children:[(0,i.jsx)(o.Z,{variant:"secondary",onClick:d,disabled:u,children:"Cancel"}),(0,i.jsx)(o.Z,{variant:"primary",type:"submit",disabled:u,children:u?"Saving...":"Save Changes"})]})]})})}var f=r(820),y=r(3711);function b(e){let{resource:s,show:r,onHide:t,onEdit:a,onDelete:d}=e,[c,u]=(0,l.useState)(!1),[m,x]=(0,l.useState)(!1),v=s.previewImage,p=(()=>{try{return JSON.parse(s.description)}catch(e){return{title:s.title,description:s.description,credentials:{}}}})();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.Z,{show:r,onHide:t,size:"lg",centered:!0,children:[(0,i.jsx)(n.Z.Header,{closeButton:!0,children:(0,i.jsx)(n.Z.Title,{children:s.title})}),(0,i.jsxs)(n.Z.Body,{children:[v&&(0,i.jsx)("div",{className:"text-center mb-4",children:(0,i.jsx)("img",{src:v,alt:s.title,className:"img-fluid rounded shadow-sm",style:{maxHeight:"400px",width:"auto"}})}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h6",{className:"text-muted mb-3",children:"Description"}),(0,i.jsx)("div",{className:"formatted-content",dangerouslySetInnerHTML:{__html:p.description}})]}),p.courseContent&&p.courseContent.length>0&&(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h6",{className:"text-muted mb-3",children:"Course Content"}),(0,i.jsx)("div",{className:"bg-light rounded p-3",children:(0,i.jsx)("ul",{className:"list-unstyled mb-0",children:p.courseContent.map((e,s)=>(0,i.jsxs)("li",{className:"mb-2 d-flex",children:[(0,i.jsx)("span",{className:"text-primary me-2",children:"â€¢"}),(0,i.jsx)("span",{children:e})]},s))})})]}),p.credentials&&(p.credentials.username||p.credentials.password)&&(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h6",{className:"text-muted mb-3",children:"Credentials"}),(0,i.jsxs)("div",{className:"bg-light rounded p-3",children:[p.credentials.username&&(0,i.jsxs)("div",{className:"mb-2",children:[(0,i.jsx)("strong",{className:"me-2",children:"Username:"}),(0,i.jsx)("code",{children:p.credentials.username})]}),p.credentials.password&&(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{className:"me-2",children:"Password:"}),(0,i.jsx)("code",{children:p.credentials.password})]})]})]}),s.additionalUrls&&s.additionalUrls.length>0&&(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h6",{className:"text-muted mb-3",children:"Additional Resources"}),(0,i.jsx)("div",{className:"bg-light rounded p-3",children:(0,i.jsx)("ul",{className:"list-unstyled mb-0",children:s.additionalUrls.map((e,s)=>(0,i.jsx)("li",{className:"mb-2",children:(0,i.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"d-flex align-items-center text-decoration-none",onClick:e=>e.stopPropagation(),children:[(0,i.jsx)(f.Z,{size:14,className:"me-2 text-primary"}),(0,i.jsx)("span",{className:"text-break",children:e}),(0,i.jsx)(y.Z,{size:14,className:"ms-2 text-muted"})]})},s))})})]}),(0,i.jsxs)("div",{className:"d-flex gap-2 mt-4",children:[(0,i.jsxs)(o.Z,{variant:"outline-primary",href:s.url,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),children:[(0,i.jsx)(y.Z,{size:16,className:"me-2"}),"Open Resource"]}),a&&(0,i.jsxs)(o.Z,{variant:"outline-secondary",onClick:()=>{t(),u(!0)},children:[(0,i.jsx)(h.Z,{size:16,className:"me-2"}),"Edit"]})]})]})]}),a&&(0,i.jsx)(j,{resource:s,show:c,onHide:()=>u(!1),onSave:()=>{u(!1),a()}})]})}var Z=r(2749);function N(e){let{resource:s,index:r,isFavorite:p,isCompleted:g,completedAt:f,onDelete:y,onToggleFavorite:N,onToggleComplete:w}=e,{data:C}=(0,Z.useSession)(),[S,k]=(0,l.useState)(!1),[I,E]=(0,l.useState)(!1),[L,z]=(0,l.useState)(!1),[F,T]=(0,l.useState)(!1),[H,P]=(0,l.useState)(!1),R=s.previewImage,O=async()=>{try{T(!0);let e=await fetch("/api/resources/".concat(s.id),{method:"DELETE"});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to delete resource")}z(!1),y()}catch(e){console.error("Error deleting resource:",e)}finally{T(!1)}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v._l,{draggableId:s.id,index:r,children:e=>(0,i.jsx)("div",{ref:e.innerRef,...e.draggableProps,...e.dragHandleProps,className:"mb-3",children:(0,i.jsxs)(t.Z,{className:"h-100 shadow-sm",onClick:()=>E(!0),style:{cursor:"pointer",position:"relative",zIndex:H?1e3:"auto"},children:[(0,i.jsx)("div",{className:"card-img-top",style:{height:"120px",backgroundImage:R?"url(".concat(R,")"):"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:"#f8f9fa"}}),(0,i.jsxs)(t.Z.Body,{className:"p-3",children:[(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,i.jsx)("h6",{className:"mb-0 fw-semibold",children:s.title}),(0,i.jsxs)(a.Z,{onClick:e=>e.stopPropagation(),onToggle:e=>P(e),children:[(0,i.jsx)(a.Z.Toggle,{variant:"link",className:"p-0 text-muted",children:(0,i.jsx)(d.Z,{size:16})}),(0,i.jsxs)(a.Z.Menu,{align:"end",style:{zIndex:1e3},children:[(0,i.jsxs)(a.Z.Item,{onClick:N,children:[(0,i.jsx)(c.Z,{size:16,className:"me-2"}),p?"Remove Favorite":"Add Favorite"]}),(0,i.jsxs)(a.Z.Item,{onClick:w,children:[(0,i.jsx)(u.Z,{size:16,className:"me-2"}),g?"Mark Incomplete":"Mark Complete"]}),(0,i.jsxs)(a.Z.Item,{onClick:()=>k(!0),children:[(0,i.jsx)(h.Z,{size:16,className:"me-2"}),"Edit"]}),(0,i.jsx)(a.Z.Divider,{}),(0,i.jsxs)(a.Z.Item,{onClick:()=>z(!0),className:"text-danger",children:[(0,i.jsx)(m.Z,{size:16,className:"me-2"}),"Delete"]})]})]})]}),(0,i.jsxs)("div",{className:"d-flex align-items-center gap-2 mt-2",children:[p&&(0,i.jsx)(c.Z,{size:16,className:"text-warning",fill:"currentColor"}),g&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Z,{size:16,className:"text-success",fill:"currentColor"}),f&&(0,i.jsxs)("div",{className:"small text-muted d-flex align-items-center",children:[(0,i.jsx)(x.Z,{size:12,className:"me-1"}),new Date(f).toLocaleDateString()]})]})]})]})]})})}),(0,i.jsx)(j,{resource:s,show:S,onHide:()=>k(!1),onSave:y}),(0,i.jsx)(b,{resource:s,show:I,onHide:()=>E(!1)}),(0,i.jsxs)(n.Z,{show:L,onHide:()=>z(!1),children:[(0,i.jsx)(n.Z.Header,{closeButton:!0,children:(0,i.jsx)(n.Z.Title,{children:"Confirm Delete"})}),(0,i.jsxs)(n.Z.Body,{children:['Are you sure you want to delete "',s.title,'"?']}),(0,i.jsxs)(n.Z.Footer,{children:[(0,i.jsx)(o.Z,{variant:"secondary",onClick:()=>z(!1),disabled:F,children:"Cancel"}),(0,i.jsx)(o.Z,{variant:"danger",onClick:O,disabled:F,children:F?"Deleting...":"Delete"})]})]})]})}var w=r(382),C=r(2824),S=r(8597),k=r(4434),I=r(3414),E=r(7744),L=r(4117),z=r(3379),F=r(7410);function T(e){let{activeFilters:s,onFilterChange:r}=e;return(0,i.jsxs)(E.Z,{children:[(0,i.jsxs)(o.Z,{variant:s.has("favorites")?"warning":"outline-warning",onClick:()=>r("favorites"),className:"d-flex align-items-center gap-2",children:[(0,i.jsx)(L.Z,{})," Favorites"]}),(0,i.jsxs)(o.Z,{variant:s.has("completed")?"success":"outline-success",onClick:()=>r("completed"),className:"d-flex align-items-center gap-2",children:[(0,i.jsx)(z.Z,{})," Completed"]}),(0,i.jsxs)(o.Z,{variant:s.has("incomplete")?"info":"outline-info",onClick:()=>r("incomplete"),className:"d-flex align-items-center gap-2",children:[(0,i.jsx)(F.Z,{})," Incomplete"]})]})}var H=r(4059);function P(e){let{categoryId:s,onResourceAdded:r}=e,[t,a]=(0,l.useState)(!1),[d,c]=(0,l.useState)(null),[u,h]=(0,l.useState)(!1),[m,x]=(0,l.useState)([]),[v,j]=(0,l.useState)(""),[f,y]=(0,l.useState)(null),[b,Z]=(0,l.useState)({title:"",description:"",url:"",type:"",categoryId:s||""});(0,l.useEffect)(()=>{t&&N()},[t]),(0,l.useEffect)(()=>{b.url&&C(b.url)},[b.url]);let N=async()=>{try{let e=await fetch("/api/categories");if(!e.ok)throw Error("Failed to fetch categories");let r=await e.json();if(x(r),s){let e=r.find(e=>e.id===s);y(e||null)}}catch(e){c("Failed to load categories")}},C=async e=>{try{let s=await fetch("/api/preview?url=".concat(encodeURIComponent(e)));if(!s.ok)return;let r=await s.json();r.image&&j(r.image)}catch(e){console.error("Error fetching preview:",e)}},S=async e=>{e.preventDefault(),c(null),h(!0);try{let e={title:b.title,description:b.description,credentials:{},courseContent:[]},s={title:b.title,description:JSON.stringify(e),url:b.url,type:b.type,categoryId:b.categoryId,previewImage:v||(null==f?void 0:f.defaultImage)||""};if(!s.title||!s.description||!s.url||!s.type||!s.categoryId)throw Error("All fields are required");let i=await fetch("/api/resources",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok){let e=await i.json();throw Error(e.error||"Failed to add resource")}a(!1),r&&r()}catch(e){c(e instanceof Error?e.message:"An error occurred")}finally{h(!1)}},k=e=>{Z(s=>({...s,categoryId:e})),y(m.find(s=>s.id===e)||null)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Z,{variant:"primary",onClick:()=>a(!0),children:"Add Resource"}),(0,i.jsxs)(n.Z,{show:t,onHide:()=>a(!1),size:"lg",children:[(0,i.jsx)(n.Z.Header,{closeButton:!0,children:(0,i.jsx)(n.Z.Title,{children:"Add New Resource"})}),(0,i.jsxs)(n.Z.Body,{children:[d&&(0,i.jsx)(w.Z,{variant:"danger",className:"mb-3",children:d}),(0,i.jsxs)(p.Z,{onSubmit:S,children:[(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{htmlFor:"title",children:"Title"}),(0,i.jsx)(p.Z.Control,{id:"title",type:"text",value:b.title,onChange:e=>Z(s=>({...s,title:e.target.value})),required:!0,placeholder:"Enter title"})]}),(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{htmlFor:"description",children:"Description"}),(0,i.jsx)(g.M,{apiKey:"k8fzh2z7v1akjnv2yo197wht8fe2gv9ml9qn0lgc8li8298r",value:b.description,onEditorChange:e=>{Z(s=>({...s,description:e}))},init:{height:300,menubar:!1,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","code","help","wordcount"],toolbar:"undo redo | blocks | bold italic forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"}})]}),(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{htmlFor:"url",children:"URL"}),(0,i.jsx)(p.Z.Control,{id:"url",type:"url",value:b.url,onChange:e=>Z(s=>({...s,url:e.target.value})),required:!0,placeholder:"Enter URL"})]}),(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{children:"Preview Image URL"}),(0,i.jsx)(p.Z.Control,{type:"url",value:v,onChange:e=>j(e.target.value),placeholder:"Enter image URL or /assets/... path"}),v&&(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)("img",{src:v,alt:"Preview",className:"img-fluid rounded",style:{maxHeight:"200px"}})})]}),(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{htmlFor:"resourceType",children:"Resource Type"}),(0,i.jsxs)(p.Z.Select,{id:"resourceType",value:b.type,onChange:e=>Z(s=>({...s,type:e.target.value})),required:!0,"aria-label":"Resource type",title:"Select resource type",children:[(0,i.jsx)("option",{value:"",children:"Select a type"}),Object.values(H.ResourceType).map(e=>(0,i.jsx)("option",{value:e,children:e},e))]})]}),!s&&(0,i.jsxs)(p.Z.Group,{className:"mb-3",children:[(0,i.jsx)(p.Z.Label,{htmlFor:"categoryId",children:"Category"}),(0,i.jsxs)(p.Z.Select,{id:"categoryId",value:b.categoryId,onChange:e=>k(e.target.value),required:!0,"aria-label":"Category",title:"Select category",children:[(0,i.jsx)("option",{value:"",children:"Select a category"}),m.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,i.jsxs)("div",{className:"d-flex justify-content-end gap-2",children:[(0,i.jsx)(o.Z,{variant:"secondary",onClick:()=>a(!1),disabled:u,children:"Cancel"}),(0,i.jsx)(o.Z,{variant:"primary",type:"submit",disabled:u,children:u?"Adding...":"Add"})]})]})]})]})]})}var R=r(6586),O=r(9352);function D(e){let{searchTerm:s,onSearchChange:r,placeholder:l="Search resources..."}=e;return(0,i.jsxs)(R.Z,{children:[(0,i.jsx)(R.Z.Text,{className:"bg-dark border-secondary",children:(0,i.jsx)(O.Z,{className:"text-secondary"})}),(0,i.jsx)(p.Z.Control,{type:"text",placeholder:l,value:s,onChange:e=>r(e.target.value),className:"bg-dark text-white border-secondary"})]})}var G=r(7972),U=r(5883),A=r(1097);function B(){let{data:e,status:s}=(0,Z.useSession)();if("loading"===s)return(0,i.jsxs)(o.Z,{variant:"outline-light",disabled:!0,children:[(0,i.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Loading..."]});if(e){var r,l;return(0,i.jsxs)(a.Z,{align:"end",children:[(0,i.jsxs)(a.Z.Toggle,{variant:"outline-light",id:"user-menu",children:[(0,i.jsx)(G.Z,{size:18,className:"me-2"}),(null===(r=e.user)||void 0===r?void 0:r.name)||(null===(l=e.user)||void 0===l?void 0:l.email)]}),(0,i.jsx)(a.Z.Menu,{children:(0,i.jsxs)(a.Z.Item,{onClick:()=>(0,Z.signOut)(),children:[(0,i.jsx)(U.Z,{size:16,className:"me-2"}),"Sign Out"]})})]})}return(0,i.jsxs)(o.Z,{variant:"outline-light",onClick:()=>(0,Z.signIn)(),children:[(0,i.jsx)(A.Z,{size:18,className:"me-2"}),"Sign In"]})}function _(){let[e,s]=(0,l.useState)([]),[r,t]=(0,l.useState)([]),[a,n]=(0,l.useState)(null),[o,d]=(0,l.useState)(!0),[c,u]=(0,l.useState)(new Set),[h,m]=(0,l.useState)(""),{data:x}=(0,Z.useSession)();(0,l.useEffect)(()=>{g()},[]);let p=async e=>{if(!e.destination||!(null==x?void 0:x.user))return;let{source:s,destination:i,draggableId:l}=e;try{var t,a,n,o,d,c,u,h,m,v,p,j,f,y,b,Z;let e;let s=r.filter(e=>e.categoryId===i.droppableId).sort((e,s)=>{var r,i,l,t,a,n;let o=null!==(a=null===(i=e.orders)||void 0===i?void 0:null===(r=i.find(e=>{var s;return e.userId===(null===(s=x.user)||void 0===s?void 0:s.id)}))||void 0===r?void 0:r.order)&&void 0!==a?a:0,d=null!==(n=null===(t=s.orders)||void 0===t?void 0:null===(l=t.find(e=>{var s;return e.userId===(null===(s=x.user)||void 0===s?void 0:s.id)}))||void 0===l?void 0:l.order)&&void 0!==n?n:0;return o-d});if(0===i.index)e=(null!==(o=null===(n=s[0])||void 0===n?void 0:null===(a=n.orders)||void 0===a?void 0:null===(t=a.find(e=>{var s;return e.userId===(null===(s=x.user)||void 0===s?void 0:s.id)}))||void 0===t?void 0:t.order)&&void 0!==o?o:1e3)/2;else if(i.index>=s.length)e=(null!==(h=null===(u=s[s.length-1])||void 0===u?void 0:null===(c=u.orders)||void 0===c?void 0:null===(d=c.find(e=>{var s;return e.userId===(null===(s=x.user)||void 0===s?void 0:s.id)}))||void 0===d?void 0:d.order)&&void 0!==h?h:1e3)+1e3;else{let r=null!==(b=null===(p=s[i.index-1])||void 0===p?void 0:null===(v=p.orders)||void 0===v?void 0:null===(m=v.find(e=>{var s;return e.userId===(null===(s=x.user)||void 0===s?void 0:s.id)}))||void 0===m?void 0:m.order)&&void 0!==b?b:0,l=null!==(Z=null===(y=s[i.index])||void 0===y?void 0:null===(f=y.orders)||void 0===f?void 0:null===(j=f.find(e=>{var s;return e.userId===(null===(s=x.user)||void 0===s?void 0:s.id)}))||void 0===j?void 0:j.order)&&void 0!==Z?Z:1e3;e=(r+l)/2}if(!(await fetch("/api/resources/".concat(l,"/position"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({categoryId:i.droppableId,order:e})})).ok)throw Error("Failed to update resource position");g()}catch(e){console.error("Failed to update resource position:",e)}},g=async()=>{try{d(!0);let[e,r]=await Promise.all([fetch("/api/categories"),fetch("/api/resources")]);if(!e.ok||!r.ok)throw Error("Failed to fetch data");let[i,l]=await Promise.all([e.json(),r.json()]);s(i),t(l),n(null)}catch(e){n(e instanceof Error?e.message:"An error occurred")}finally{d(!1)}},j=async e=>{if(null==x?void 0:x.user)try{if(!(await fetch("/api/resources/".concat(e,"/favorite"),{method:"POST"})).ok)throw Error("Failed to toggle favorite");g()}catch(e){console.error("Error toggling favorite:",e)}},f=async e=>{if(null==x?void 0:x.user)try{if(!(await fetch("/api/resources/".concat(e,"/complete"),{method:"POST"})).ok)throw Error("Failed to toggle complete");g()}catch(e){console.error("Error toggling complete:",e)}},y=e=>r.filter(s=>{var r,i;let l=""===h||s.title.toLowerCase().includes(h.toLowerCase())||(null!==(i=null===(r=s.description)||void 0===r?void 0:r.toLowerCase())&&void 0!==i?i:"").includes(h.toLowerCase()),t=s.categoryId===e;if(0===c.size)return l&&t;let a=s.favoritedBy.some(e=>{var s;return e.id===(null==x?void 0:null===(s=x.user)||void 0===s?void 0:s.id)}),n=s.completedBy.some(e=>{var s;return e.id===(null==x?void 0:null===(s=x.user)||void 0===s?void 0:s.id)}),o=c.has("favorites")&&a||c.has("completed")&&n||c.has("incomplete")&&!n;return l&&t&&o}).sort((e,s)=>{var r,i,l,t,a,n;return(null!==(a=null===(i=e.orders)||void 0===i?void 0:null===(r=i.find(e=>{var s;return e.userId===(null==x?void 0:null===(s=x.user)||void 0===s?void 0:s.id)}))||void 0===r?void 0:r.order)&&void 0!==a?a:0)-(null!==(n=null===(t=s.orders)||void 0===t?void 0:null===(l=t.find(e=>{var s;return e.userId===(null==x?void 0:null===(s=x.user)||void 0===s?void 0:s.id)}))||void 0===l?void 0:l.order)&&void 0!==n?n:0)});return o?(0,i.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:(0,i.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,i.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):a?(0,i.jsxs)(w.Z,{variant:"danger",children:[(0,i.jsx)(w.Z.Heading,{children:"Error loading data"}),(0,i.jsx)("p",{children:a})]}):(0,i.jsx)("div",{className:"bg-dark text-white min-vh-100",children:(0,i.jsxs)("div",{className:"py-3",children:[(0,i.jsx)(C.Z,{children:(0,i.jsxs)(S.Z,{className:"align-items-center mb-4",children:[(0,i.jsx)(k.Z,{xs:"auto",children:(0,i.jsx)(I.Z,{src:"/logo-ols-2023.png",alt:"Logo",height:40})}),(0,i.jsx)(k.Z,{children:(0,i.jsx)(D,{searchTerm:h,onSearchChange:m,placeholder:"Search resources by title or description..."})}),(0,i.jsxs)(k.Z,{xs:"auto",className:"d-flex gap-3 align-items-center",children:[(0,i.jsx)(T,{activeFilters:c,onFilterChange:e=>{u(s=>{let r=new Set(s);return r.has(e)?r.delete(e):r.add(e),r})}}),(0,i.jsx)(P,{}),(0,i.jsx)(B,{})]})]})}),(0,i.jsx)("div",{className:"px-4",children:(0,i.jsx)(v.Z5,{onDragEnd:p,children:(0,i.jsx)("div",{className:"kanban-board d-flex gap-4 overflow-auto pb-4",children:e.map(e=>(0,i.jsx)("div",{className:"kanban-column",style:{minWidth:"340px",maxWidth:"340px"},children:(0,i.jsxs)("div",{className:"bg-white rounded-3 h-100 d-flex flex-column shadow-sm",children:[e.defaultImage?(0,i.jsx)("div",{className:"rounded-top-3",style:{height:"50px",backgroundImage:"url(".concat(e.defaultImage,")"),backgroundSize:"cover",backgroundPosition:"center"}}):(0,i.jsxs)("div",{className:"p-3 border-bottom",children:[(0,i.jsx)("h3",{className:"h5 mb-1",children:e.name}),e.description&&(0,i.jsx)("small",{className:"text-muted",children:e.description})]}),(0,i.jsx)(v.bK,{droppableId:e.id,children:s=>(0,i.jsxs)("div",{ref:s.innerRef,...s.droppableProps,className:"p-3 flex-grow-1",style:{minHeight:"100px",overflowY:"auto",maxHeight:"calc(100vh - 200px)"},children:[(0,i.jsx)("div",{className:"d-flex flex-column gap-3",children:y(e.id).map((e,s)=>{var r,l;return(0,i.jsx)(N,{resource:e,onDelete:g,index:s,isFavorite:null===(r=e.favoritedBy)||void 0===r?void 0:r.some(e=>{var s;return e.id===(null==x?void 0:null===(s=x.user)||void 0===s?void 0:s.id)}),isCompleted:null===(l=e.completedBy)||void 0===l?void 0:l.some(e=>{var s;return e.id===(null==x?void 0:null===(s=x.user)||void 0===s?void 0:s.id)}),onToggleFavorite:()=>j(e.id),onToggleComplete:()=>f(e.id)},e.id)})}),s.placeholder]})})]})},e.id))})})})]})})}},386:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return c}});var i=r(7437),l=r(2749),t=r(4033),a=r(2265),n=r(382),o=r(6716),d=r(1097);function c(e){let{children:s}=e,{data:r,status:c}=(0,l.useSession)(),u=(0,t.useRouter)();return((0,a.useEffect)(()=>{"unauthenticated"===c&&u.push("/")},[c,u]),"loading"===c)?(0,i.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:(0,i.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,i.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):r?(0,i.jsx)(i.Fragment,{children:s}):(0,i.jsxs)(n.Z,{variant:"warning",className:"text-center",children:[(0,i.jsx)(n.Z.Heading,{children:"Please sign in to access this page"}),(0,i.jsx)("p",{children:"You need to be authenticated to view and manage resources."}),(0,i.jsxs)(o.Z,{variant:"primary",onClick:()=>(0,l.signIn)(),className:"mt-3",children:[(0,i.jsx)(d.Z,{size:18,className:"me-2"}),"Sign In"]})]})}}},function(e){e.O(0,[338,749,963,372,756,435,765,971,938,744],function(){return e(e.s=9967)}),_N_E=e.O()}]);